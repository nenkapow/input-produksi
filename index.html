<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <title>Production System v2.6.0</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Plus+Jakarta+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css?v=2.6.0">
</head>
<body>

<div id="loading" class="loading-overlay">
    <div class="spinner"></div>
    <div style="margin-top:16px; font-weight:600; color:var(--gold); letter-spacing:1px;">MENGHUBUNGKAN...</div>
</div>

<div class="wrap">
    <div class="bismillah">ÿ®ÿ≥ŸÖ ÿßŸÑŸÑŸá ÿßŸÑÿ±ÿ≠ŸÖŸÜ ÿßŸÑÿ±ÿ≠ŸäŸÖ</div>
    <div class="slogan">"Dashboard Production - High Performance"</div>

    <div class="row header-row" style="justify-content:space-between; align-items:center; margin-bottom:40px;">
        <div>
            <h2>Main Menu</h2>
            <div class="row" style="align-items:center; gap:8px; margin-top:8px;">
                <span class="badge">v2.6.0 (Fast Load)</span>
                <span id="statusDb" style="font-size:0.8rem; color:var(--danger)">Disconnected</span>
            </div>
        </div>
        <div><button id="btnRefresh" class="btn">‚ü≥ Sync Data (30 Hari)</button></div>
    </div>

    <div class="menu-grid">
        <div id="btnAdd" class="menu-card primary"><div class="icon">üìù</div><h3>Input Produksi</h3><p>Form Laporan Shift</p></div>
        <div id="btnDashboard" class="menu-card primary"><div class="icon">üìä</div><h3>Monitoring Room</h3><p>Analisa Chart & Pareto</p></div>
        <div id="btnOpenLog" class="menu-card"><div class="icon">üìÅ</div><h3>Data Harian</h3><p>Lihat Tabel & History</p></div>
        <div id="btnRekap" class="menu-card"><div class="icon">üè≠</div><h3>Rekap Line</h3><p>Total Output per Mesin</p></div>
        <div id="btnMaster" class="menu-card"><div class="icon">üì¶</div><h3>Master Produk</h3><p>Database Item</p></div>
        <div id="btnConfig" class="menu-card"><div class="icon">‚öôÔ∏è</div><h3>Konfigurasi</h3><p>Koneksi Database</p></div>
    </div>
    <div style="text-align:center; margin-top:40px; color:var(--text-muted); font-size:0.8rem;">&copy; 2026 Production System</div>
</div>

<div id="vLaporan" class="modal full">
    <div class="wrap-full"> 
        <div class="row" style="justify-content:space-between; align-items:center; margin-bottom:24px; border-bottom:1px solid var(--border); padding-bottom:16px;">
            <h2 style="color:var(--gold);">üìÅ Data Laporan Harian</h2>
            <div class="row">
                <button id="btnLoadFull" class="btn info sm" title="Ambil semua data lama">Load Full</button>
                <button id="btnExport" class="btn ok sm">Export CSV</button>
                <button id="btnClear" class="btn danger sm">Reset Data</button>
                <button id="vLaporanClose" class="btn">KEMBALI</button>
            </div>
        </div>
        <div class="card sticky-header">
            <div class="row" style="align-items:flex-end;">
                <div style="flex:1; min-width:140px"><div class="muted">Dari</div><input id="fFrom" type="date" class="input"></div>
                <div style="flex:1; min-width:140px"><div class="muted">Sampai</div><input id="fTo" type="date" class="input"></div>
                <div style="flex:2; min-width:200px"><div class="muted">Cari Produk</div><input id="fProduk" class="input" placeholder="Ketik..." /></div>
                <div style="flex:1; min-width:100px"><div class="muted">Shift</div><select id="fShift" class="input"><option value="">All</option><option>1</option><option>2</option><option>3</option></select></div>
                <div style="flex:1; min-width:120px"><div class="muted">Line</div><input id="fLine" class="input" placeholder="L-01" /></div>
                <div><button id="btnClearFilter" class="btn">Reset</button></div>
            </div>
        </div>
        <div class="card" style="padding:0;">
            <div style="padding:16px 24px; background:#252525; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid var(--border);">
                <div class="muted">Menampilkan Data</div><span id="rowCount" class="badge">0 baris</span>
            </div>
            <div class="table-container" style="border:none; border-radius:0;">
                <table>
                    <thead><tr><th>Tanggal</th><th>Shift</th><th>Line</th><th>Produk</th><th>Tipe</th><th class="right">Counter</th><th class="right">Cav</th><th class="right">Dus</th><th class="right">Box</th><th class="right">OK (pcs)</th><th class="right">OK (kg)</th><th class="right">Reject</th><th class="right">Sisa Bhn</th><th class="right">Yield %</th><th class="right">R. Max</th><th style="text-align:center">Aksi</th></tr></thead>
                    <tbody id="tbody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div id="pDashboard" class="modal full">
    <div class="wrap-full">
        <div class="row" style="justify-content:space-between; align-items:center; margin-bottom:24px; border-bottom:1px solid var(--border); padding-bottom:16px;">
            <h2 style="color:var(--gold); display:flex; align-items:center; gap:10px;">üìä Monitoring Room <span class="badge">Live</span></h2>
            <button id="pDashboardClose" class="btn danger">KEMBALI</button>
        </div>
        <div class="card sticky-header">
            <div class="row" style="align-items:flex-end;">
                <div style="flex:1"><div class="muted">Awal</div><input id="dFrom" type="date" class="input"></div>
                <div style="flex:1"><div class="muted">Akhir</div><input id="dTo" type="date" class="input"></div>
                <div style="flex:1"><div class="muted">Filter Line</div><input id="dLine" class="input" placeholder="Semua Line"></div>
                <button id="btnLoadDash" class="btn primary">ANALISA</button>
            </div>
        </div>
        
        <div class="grid-simple cols-4" style="margin-bottom: 24px;">
            <div class="stat-box" style="background:#111; border-color:var(--gold);"><div class="muted">Total Produksi</div><span id="kpiHasil" class="stat-value" style="color:var(--text-main); font-size:1.5rem;">0</span></div>
            <div class="stat-box" style="background:#111; border-color:var(--success);"><div class="muted">Total OK</div><span id="kpiOk" class="stat-value" style="color:var(--success); font-size:1.5rem;">0</span></div>
            <div class="stat-box" style="background:#111; border-color:var(--danger);"><div class="muted">Total Reject</div><span id="kpiReject" class="stat-value" style="color:var(--danger); font-size:1.5rem;">0</span></div>
            <div class="stat-box" style="background:#111;"><div class="muted">Avg Yield</div><span id="kpiYield" class="stat-value" style="color:var(--gold); font-size:1.5rem;">0%</span></div>
        </div>

        <div class="row" style="align-items:stretch;">
            <div class="card" style="flex:2; min-width:300px;"><h3 style="margin-bottom:16px; font-size:1rem;">üìà Trend Produksi</h3><div style="height:300px;"><canvas id="chartTrend"></canvas></div></div>
            <div class="card" style="flex:1; min-width:300px;"><h3 style="margin-bottom:16px; font-size:1rem; color:var(--danger);">‚ö† Pareto Reject (Jenis)</h3><div style="height:300px;"><canvas id="chartPareto"></canvas></div></div>
        </div>

        <div class="row" style="align-items:stretch;">
            <div class="card" style="flex:1; min-width:300px;">
                <h3 style="margin-bottom:12px; font-size:1rem; color:var(--success);">üèÜ Top 5 Produk (OK Terbanyak)</h3>
                <div class="table-container">
                    <table id="tblTopProd">
                        <thead><tr><th>Produk</th><th class="right">Total OK</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div class="card" style="flex:1; min-width:300px;">
                <h3 style="margin-bottom:12px; font-size:1rem; color:var(--danger);">üíÄ Top 5 Produk (Reject Terbanyak)</h3>
                <div class="table-container">
                    <table id="tblTopReject"> 
                        <thead><tr><th>Produk</th><th class="right">Total Reject</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div> 
    </div> 
</div> 

<div id="mRekap" class="modal full">
    <div class="wrap-full">
        <div class="card">
            <div class="row" style="justify-content:space-between; margin-bottom:16px; align-items:center;">
                <h2 style="color:var(--gold); margin-bottom:4px;">üè≠ Rekapitulasi Line</h2>
                <button id="mRekapClose" class="btn sm danger">KEMBALI</button>
            </div>
            <div class="row" style="margin-bottom:16px; align-items:flex-end; background:#151515; padding:20px; border-radius:12px; border:1px solid var(--border);">
                <div style="flex:1; min-width:200px;"><div class="muted">Dari Tanggal</div><input id="rDateFrom" type="date" class="input"></div>
                <div style="flex:1; min-width:200px;"><div class="muted">Sampai Tanggal</div><input id="rDateTo" type="date" class="input"></div>
                <div style="flex:0;"><button id="btnRefreshRekap" class="btn primary" style="height:46px; padding:0 30px;">PROSES DATA</button></div>
            </div>
            <div style="display:flex; gap:12px; margin-bottom:24px;">
                <button class="filter-btn active" onclick="filterRekap('all', this)" style="padding:12px;">SEMUA SHIFT</button>
                <button class="filter-btn" onclick="filterRekap('1', this)" style="padding:12px;">SHIFT 1</button>
                <button class="filter-btn" onclick="filterRekap('2', this)" style="padding:12px;">SHIFT 2</button>
                <button class="filter-btn" onclick="filterRekap('3', this)" style="padding:12px;">SHIFT 3</button>
            </div>
            <div style="margin-bottom:16px;" id="rekapMachineCount" class="muted">Total Mesin: 0</div>
            <div class="table-container">
                <table><thead><tr><th>Line / Mesin</th><th>Produk (Kode)</th><th class="right">Total OK (pcs)</th><th class="right">Total Reject</th><th class="right">Total OK (kg)</th><th class="right">Avg Yield</th></tr></thead><tbody id="tbodyRekap"></tbody></table>
            </div>
        </div>
    </div>
</div>

<div id="mMaster" class="modal">
    <div class="card" style="max-width:1000px; width:95%;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2 style="color:var(--gold); margin:0;">MASTER PRODUK</h2>
            <button id="mMasterClose" class="btn sm danger">TUTUP</button>
        </div>

        <div class="card" style="background:var(--bg-input); margin-bottom:20px; border:1px dashed var(--gold);">
            <div style="font-weight:700; color:var(--gold); margin-bottom:15px; font-size:0.9rem;">TAMBAH / EDIT PRODUK MANUAL</div>
            <div class="grid cols-4">
                <div><div class="muted">Kode</div><input id="mpKode" class="input" placeholder="Contoh: L-01" /></div>
                <div><div class="muted">Nama Produk</div><input id="mpNama" class="input" /></div>
                <div><div class="muted">Tipe</div><select id="mpTipe" class="input"><option value="pcs">Mode PCS</option><option value="kg_sisa">Mode KG</option></select></div>
                <div><div class="muted">Gramasi</div><input id="mpGram" type="number" class="input" /></div>
                <div><div class="muted">Runner (g)</div><input id="mpRunner" type="number" class="input" /></div>
                <div><div class="muted">Cavity</div><input id="mpCavity" type="number" class="input" /></div>
                <div><div class="muted">Pcs/Dus</div><input id="mpPerDus" type="number" class="input" /></div>
                <div><div class="muted">Pcs/Box</div><input id="mpPerBox" type="number" class="input" /></div>
            </div>
            <button id="mpAdd" class="btn primary" style="width:100%; margin-top:15px;">SIMPAN KE MASTER</button>
        </div>

        <div style="margin-bottom: 16px;">
            <div class="muted" style="margin-bottom: 5px;">Cari Produk (Kode / Nama)</div>
            <input id="fMasterSearch" class="input" placeholder="Ketik nama atau kode produk..." style="border-color: var(--gold); background: var(--bg-input);" />
        </div>

        <div class="table-container" style="max-height:400px;">
            <table>
                <thead>
                    <tr>
                        <th>Kode</th>
                        <th>Nama</th>
                        <th>Tipe</th>
                        <th>Gram</th>
                        <th>Runner</th>
                        <th>Cav</th>
                        <th>Pcs/Dus</th>
                        <th style="width:80px">Aksi</th>
                    </tr>
                </thead>
                <tbody id="mpBody"></tbody>
            </table>
        </div>

        <div style="margin-top:20px; display:flex; gap:10px;">
            <button id="btnImportCsv" class="btn info" style="flex:1">IMPORT CSV</button>
            <button id="btnWipeMaster" class="btn danger" style="flex:1">HAPUS SEMUA MASTER</button>
            <input type="file" id="fileCsvMaster" accept=".csv" style="display:none" />
        </div>
    </div>
</div>

<div id="mEntry" class="modal full">
    <div class="wrap-full">
        <div class="card">
            
            <div class="row" style="justify-content:space-between; margin-bottom:20px; padding-bottom:16px; border-bottom:1px solid var(--border);">
                <div style="display:flex; align-items:center; gap:12px;">
                    <h2 style="color:var(--gold)">üìù Input Laporan Shift</h2>
                    <span id="badgeTipe" class="badge"></span>
                </div>
                <button id="mEntryClose" class="btn danger" style="padding:10px 30px;">BATAL / KEMBALI</button>
            </div>
            <input type="hidden" id="eId" />

            <div style="display:flex; flex-direction:column; gap:24px; width:100%;">
                
                <div class="grid-simple cols-3">
                    <div><div class="muted">Tanggal</div><input id="eTanggal" type="date" class="input" /></div>
                    <div><div class="muted">Shift</div><select id="eShift" class="input"><option>1</option><option>2</option><option>3</option></select></div>
                    <div><div class="muted">Line</div><input id="eLine" class="input" placeholder="L..." /></div>
                </div>

                <div style="position:relative; width:100%;">
                    <div class="muted">Produk (Ketik Kode / Nama)</div>
                    <input id="eProduk" class="input" placeholder="Cari..." autocomplete="off" style="border-color:var(--gold)" />
                    <div id="produkSuggestions" class="search-list"></div>
                </div>

                <div style="height:1px; background:var(--border);"></div>

                <div class="grid-simple cols-4">
                    <div><div class="muted">Gram</div><input id="eGram" type="number" class="input" step="0.01" readonly style="background:#151515; color:var(--text-muted);" /></div>
                    <div><div class="muted">Runner</div><input id="eRunner" type="number" class="input" step="0.01" readonly style="background:#151515; color:var(--text-muted);" /></div>
                    <div><div class="muted">Cavity</div><input id="eCavity" type="number" class="input" /></div>
                    <div><div class="muted">Counter (Shot)</div><input id="eCounter" type="number" class="input" style="font-weight:bold; font-size:1.1rem; border-color:var(--gold);" /></div>
                </div>

                <div style="background:#151515; padding:20px; border-radius:12px; border:1px solid var(--border); width:100%;">
                    <h4 style="margin:0 0 16px; font-size:0.9rem; color:var(--gold);">MATERIAL USAGE (KG)</h4>
                    <div class="grid-simple cols-4">
                        <div><div class="muted">Jatah</div><input id="eJatah" type="number" step="0.01" class="input" /></div>
                        <div><div class="muted">Stok Awal</div><input id="eStok" type="number" step="0.01" class="input" /></div>
                        <div><div class="muted">Balokan</div><input id="eBalokan" type="number" step="0.01" class="input" /></div>
                        <div><div class="muted">Sisa (Auto)</div><input id="eSisaBahan" type="number" readonly class="input" style="background:#1a1a1a; font-weight:bold; color:var(--gold);" /></div>
                    </div>
                    
                    <div class="row" style="margin-top:20px; gap:30px;">
                        <div style="flex:1;">
                            <div class="muted" style="margin-bottom:8px;"><b>Sisa Sebelum (Kg/Pcs)</b></div>
                            <div class="grid-simple cols-3" style="gap:8px;">
                                <input id="eSblm1" class="input" type="number" step="0.01" /><input id="eSblm2" class="input" type="number" step="0.01" /><input id="eSblm3" class="input" type="number" step="0.01" />
                                <input id="eSblm4" class="input" type="number" step="0.01" /><input id="eSblm5" class="input" type="number" step="0.01" /><input id="eSblm6" class="input" type="number" step="0.01" />
                            </div>
                        </div>
                        <div style="flex:1;">
                            <div class="muted" style="margin-bottom:8px;"><b>Sisa Sesudah (Kg/Pcs)</b></div>
                            <div class="grid-simple cols-3" style="gap:8px;">
                                <input id="eSsdh1" class="input" type="number" step="0.01" /><input id="eSsdh2" class="input" type="number" step="0.01" /><input id="eSsdh3" class="input" type="number" step="0.01" />
                                <input id="eSsdh4" class="input" type="number" step="0.01" /><input id="eSsdh5" class="input" type="number" step="0.01" /><input id="eSsdh6" class="input" type="number" step="0.01" />
                            </div>
                        </div>
                    </div>
                </div>

                <div style="height:1px; background:var(--border);"></div>

                <div>
                    <h4 style="margin:0 0 16px; font-size:0.9rem; color:var(--gold);">PACKAGING</h4>
                    <div class="grid-simple cols-6">
                        <div><div class="muted">Dus</div><input id="eQtyDus" type="number" class="input" /></div>
                        <div><div class="muted">Isi/D</div><input id="eIsiDus" type="number" class="input" readonly style="background:#151515" /></div>
                        <div><div class="muted">Box</div><input id="eQtyBox" type="number" class="input" /></div>
                        <div><div class="muted">Isi/B</div><input id="eIsiBox" type="number" class="input" readonly style="background:#151515" /></div>
                        <div><div class="muted">Dus+</div><input id="eQtyDusPlus" type="number" class="input" /></div>
                        <div><div class="muted">Isi+</div><input id="eIsiDusPlus" type="number" class="input" /></div>
                    </div>
                    <div style="margin-top:10px;"><div class="muted">Catatan Tambahan</div><input id="eCatatan" class="input" /></div>
                </div>

                <div class="card" style="background:rgba(239, 68, 68, 0.05); border:1px solid var(--danger); padding:20px; width:100% !important; margin:0 !important;">
                    <h4 style="margin:0 0 16px; color:var(--danger); font-size:0.9rem;">REJECT DETAIL (PCS)</h4>
                    <div class="grid-simple cols-reject">
                        <div><div class="reject-label">Uneven Color</div><input id="rUneven" type="number" class="input" /></div>
                        <div><div class="reject-label">Mottled</div><input id="rMottled" type="number" class="input" /></div>
                        <div><div class="reject-label">Start Up</div><input id="rStartup" type="number" class="input" /></div>
                        <div><div class="reject-label">Short Shot</div><input id="rShort" type="number" class="input" /></div>
                        <div><div class="reject-label">Flow Mark</div><input id="rFlow" type="number" class="input" /></div>
                        <div><div class="reject-label">Flashing</div><input id="rFlash" type="number" class="input" /></div>
                        <div><div class="reject-label">Crack</div><input id="rCrack" type="number" class="input" /></div>
                        <div><div class="reject-label">Spot</div><input id="rSpot" type="number" class="input" /></div>
                        <div><div class="reject-label">Scratch</div><input id="rScratch" type="number" class="input" /></div>
                        <div><div class="reject-label">Dirty</div><input id="rDirty" type="number" class="input" /></div>
                    </div>
                    <div style="margin-top:16px; border-top:1px dashed var(--danger); padding-top:16px;">
                        <div class="muted" style="color:var(--danger); font-weight:bold;">Total Reject (Auto)</div>
                        <input id="rTotal" type="number" class="input" readonly style="font-weight:bold; font-size:1.1rem; color:var(--danger); background:#1a1a1a;" />
                        <input id="rMax" type="hidden" />
                    </div>
                </div>

                <div class="card" style="background:rgba(16, 185, 129, 0.05); border:1px solid var(--success); padding:24px; margin-bottom:0; width:100% !important; margin:0 !important;">
                    <div class="grid-simple cols-4" style="text-align:center;">
                        <div class="stat-box"><div class="muted">Hasil (Pcs)</div><span class="stat-value" id="vHasil" style="color:var(--gold)">0</span></div>
                        <div class="stat-box"><div class="muted">OK (Pcs)</div><span class="stat-value" id="vOkPcs" style="color:var(--success)">0</span></div>
                        <div class="stat-box"><div class="muted">Reject (Pcs)</div><span class="stat-value" id="vRejectPcs" style="color:var(--danger)">0</span></div>
                        <div class="stat-box"><div class="muted">Yield</div><span class="stat-value" id="vYield">0%</span></div>
                        
                        <div class="stat-box"><div class="muted">OK (Kg)</div><span class="stat-value" id="vOkKg">0.00</span></div>
                        <div class="stat-box"><div class="muted">Reject (Kg)</div><span class="stat-value" id="vRejectKg">0.00</span></div>
                        <div class="stat-box"><div class="muted">Runner (Kg)</div><span class="stat-value" id="vRunnerKg">0.00</span></div>
                        <div class="stat-box"><div class="muted">Sisa Bhn (Kg)</div><span class="stat-value" id="vSisaBahanLabel">0.00</span></div>
                    </div>
                    <div id="warnOver" style="color:var(--danger); background:rgba(239, 68, 68, 0.2); padding:10px; border-radius:8px; margin-top:20px; font-weight:600; display:none; text-align:center; border:1px solid var(--danger);">
                        ‚ö† Packaging melebihi Hasil Produksi!
                    </div>
                    <button id="btnSaveEntry" class="btn primary" style="width:100%; margin-top:30px; padding:18px; font-size:1.1rem; letter-spacing:1px; font-weight:800;">SIMPAN DATA PRODUKSI</button>
                </div>

            </div>
        </div>
    </div>
</div>

<div id="mConfig" class="modal"><div class="card" style="max-width:500px">
    <h3 style="margin-bottom:8px; color:var(--gold)">Database Setup</h3>
    <div class="grid"><div><div class="muted">Project URL</div><input id="cfgUrl" class="input" /></div><div><div class="muted">Anon Public Key</div><textarea id="cfgKey" class="input" rows="4"></textarea></div><button id="btnSaveConfig" class="btn primary" style="width:100%;">SIMPAN & KONEK</button><button id="mConfigClose" class="btn" style="width:100%">Batal</button></div>
</div></div>

<script src="app.js?v=2.6.0"></script>
<script src="dashboard.js?v=2.6.0"></script>
</body>
</html>
